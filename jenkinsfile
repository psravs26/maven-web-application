node{
    def mavenHome=tool name: "maven 3.8.5"
    echo "The node name is: ${env.NODE_NAME}"
    echo "The job name is: ${env.JOB_NAME}"
    echo "the Build number is ${env.BUILD_NUMBER}"
    //checkout
    stage('checkout'){
        checkout([$class: 'GitSCM', branches: [[name: '**']], extensions: [], userRemoteConfigs: [[credentialsId: '1ddb793b-e2ff-44e0-82bc-e3c83e2b812f', url: 'https://github.com/psravs26/maven-web-application.git']]])
    }
    //build
    stage('build'){
        sh "mvn clean package"
    }
    //sonar qube report
    stage("sonar qube report"){
        sh "mvn sonar:sonar"
    }
    //upload artifacts
    stage('upload artifacts'){
        sh "$mavenHome/bin/mvn deploy"
    }
    //deplo into tomcat
    stage('deploy into tomcat'){
        sshagent(['14f72aa2-93b7-433d-b7bd-e919f2422346']){
    sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@65.0.6.34:/opt/apache-tomcat-9.0.63/webapps"
}
    
    }
}
